<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Projector Calibration</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/calib.css') }}">
</head>
<body>
  <header>
    <h1>Projector Calibration</h1>
    <p>Status: <strong>{{ status }}</strong></p>
    <p>Session: <code>{{ session or "None" }}</code> | Poses captured: {{ views }}</p>
    <p>Projector resolution: {{ proj_w }} x {{ proj_h }}</p>
  </header>

  <main>
    <section class="video">
      <h2>Live Camera</h2>
      <img src="{{ url_for('video') }}" alt="Live video feed">
    </section>

    <section class="controls">
      <h2>Capture</h2>
      <form method="post" action="{{ url_for('proj_calib_capture') }}">
        <button type="submit">Capture GrayCode Pose</button>
      </form>

      <form method="post" action="{{ url_for('proj_calib_finish') }}">
        <label for="max_error">Drop poses with RMS above (px):</label>
        <input type="number" step="0.1" id="max_error" name="max_error" value="{{ max_error }}">
        <button type="submit" class="finish">Finish Projector Calibration</button>
      </form>

      <div class="tips">
        <h3>Workflow</h3>
        <ul>
          <li>Calibrate the camera first (/calib) so camera_intrinsics.npz exists.</li>
          <li>Use the printed checkerboard (8×6 inner corners, 10 mm squares).</li>
          <li>For each pose: place the board in view, click “Capture GrayCode Pose”. Exposure locks automatically.</li>
          <li>Move and tilt the board across the frame; capture at least 6–10 diverse poses.</li>
          <li>Click “Finish Projector Calibration” to solve intrinsics + stereo (saves projector_intrinsics.npz, stereo_params.npz).</li>
        </ul>
      </div>

      <div class="tips">
        <h3>Sessions</h3>
        <ul>
          {% for s in sessions %}
            <li>
              <form method="post" action="{{ url_for('proj_calib_select') }}" style="display:inline;">
                <input type="hidden" name="session_path" value="{{ s }}">
                <button type="submit">Load</button>
              </form>
              {{ s.name }}
            </li>
          {% else %}
            <li>No previous sessions</li>
          {% endfor %}
        </ul>
      </div>
    </section>
  </main>
</body>
</html>
